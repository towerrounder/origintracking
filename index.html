<html>

<head>
    <meta charset="UTF-8">
    <style>
        tr>td:first-child {
            text-align: right;
            width:120px;
            padding: 2px;
        }
    </style>
</head>

<body>
    <h2>Spread</h2>
    <i>Should be less than or equal to 3</i>
    <table>
        <tr>
            <td>Offer</td>
            <td>
                <input id="inOffer" type="text" />
                <i>What the sell at (always higher than the bid)</i>
            </td>
        </tr>
        <tr>
            <td>Bid</td>
            <td>
                <input id="inBid" type="text" />
                <i>What they buy at</i>
            </td>
        </tr>
        <tr>
            <td>Spread</td>
            <td>
                <input id="inSpread" readonly type="text" />
                <span id="iSpreadComment"></span>
            </td>
        </tr>
    </table>
    <h2>Net Debt Ratio</h2>
    <i>Should be less than or eual to 3</i>
    <table>
        <tr>
            <td>Net Debt</td>
            <td>
                <input id="inNetDebt" type="text" />
            </td>
        </tr>
        <tr>
            <td>Pre-tax Profit</td>
            <td>
                <input id="inPretaxProfit" type="text" />
            </td>
        </tr>
        <tr>
            <td>Debt Ratio</td>
            <td>
                <input id="inDebtRatio" readonly type="text" />
                <span id="iDebtRatioComment"></span>
            </td>
        </tr>
    </table>
    <h2>Valuation</h2>
    <i>The company should be less thatn 15 ratio profit to market cap</i>
    <table>
        <tr>
            <td>Market Cap.</td>
            <td>
                <input id="inMarketCap" type="text" />
            </td>
        </tr>
        <tr>
            <td>Market Ratio</td>
            <td>
                <input id="inMarketCapRatio" readonly type="text" />
                <span id="iMarketCapRatioComment"></span>
            </td>
        </tr>
    </table>
    <h2>Summary</h2>
    <span id="sSummary"></span>
    <script>
        var niceNumber = function (x) {
            return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script>
        var $inBid = $("#inBid");
        var $inOffer = $("#inOffer");
        var $inSpread = $("#inSpread");
        var $iSpreadComment = $("#iSpreadComment");

        var $inNetDebt = $("#inNetDebt");
        var $inPretaxProfit = $("#inPretaxProfit");
        var $inDebtRatio = $("#inDebtRatio");
        var $iDebtRatioComment = $("#iDebtRatioComment");

        var $inMarketCap = $("#inMarketCap");
        var $inMarketCapRatio = $("#inMarketCapRatio");
        var $iMarketCapRatioComment = $("#iMarketCapRatioComment");

        var $sSummary = $("#sSummary");

        $("input").on("input", function (event) {

            //Spread
            var offer = $inOffer.val();
            var bid = $inBid.val();
            var spread_difference = offer - bid;
            var spread_percentage = parseFloat(((spread_difference / offer) * 100)).toFixed(2);
            $inSpread.val(spread_percentage);
            var spread_answer = Math.round(spread_percentage) <= 3 ? "Yes" : "No";
            $iSpreadComment.text(spread_answer + ". The spread is " + spread_percentage + "%");

            //Debt to Profit Ratio
            var debt = $inNetDebt.val();
            var profit = $inPretaxProfit.val();
            var debt_proft_ratio = parseFloat(debt / profit).toFixed(2);
            $inDebtRatio.val(debt_proft_ratio);
            var debt_proft_answer = Math.round(debt_proft_ratio) <= 3 ? "Yes" : "No";
            $iDebtRatioComment.text(debt_proft_answer + ". The company had a pre-tax profit of £" + niceNumber(profit) + " and net debt of £" + niceNumber(debt) + " giving a debt to profit ratio of " + debt_proft_ratio);

            //Market Cap
            var marketcap = $inMarketCap.val();
            var market_profit_ratio = parseFloat(marketcap / profit).toFixed(2);
            $inMarketCapRatio.val(market_profit_ratio);
            var market_profit_answer = Math.round(market_profit_ratio) <= 15 ? "Yes" : "No";
            $iMarketCapRatioComment.text(market_profit_answer + ". The company had a pre-tax profit of £" + niceNumber(profit) + " and a market cap of £" + niceNumber(marketcap) + " giving a market cap to profit ratio of " + market_profit_ratio);

            //Summary
            var summary = "Spread - " + spread_answer + ": " + spread_percentage + ". ";
            summary += "Small Debt - " + debt_proft_answer + ": " + debt_proft_ratio + ". ";
            summary += "Undervalued - " + market_profit_answer + ": " + market_profit_ratio + ".";
            $sSummary.text(summary);
        });

    </script>
</body>

</html>
